---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import GradientLine from '../components/GradientLine.astro';
import Socials from '../components/Socials.astro';

const recentPosts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
  });
}
---

<BaseLayout title="Cristobal Lillo">
  <div class="max-w-[var(--spacing-prose)] pt-8">
    <!-- Intro -->
    <section class="mb-20">
      <h1 class="font-serif text-4xl font-semibold mb-2 leading-tight">
        Cristobal Lillo
      </h1>
      <Socials class="mb-5" />
      <p class="text-lg leading-relaxed text-[var(--color-muted)] mb-6">
      Math + CS guy in love with stochastic modelling, statistical learning, game theory, scientific computing, information theory, and so much more.
      </p>
    </section>

    <!-- Professional Experience -->
    <section class="mb-20">
      <h2 class="text-sm font-medium uppercase tracking-wider text-[var(--color-muted)] mb-6">
        Professional Experience
      </h2>
      <GradientLine seed={11} class="mb-8" />
      <ul class="space-y-8">
        <li>
          <div class="flex items-baseline justify-between gap-4">
            <span class="font-serif text-lg font-medium">Examedi</span>
            <span class="text-xs text-[var(--color-muted)] flex-shrink-0">Summer 2024</span>
          </div>
          <div class="mt-2 pl-3 border-l border-[var(--color-border)]">
            <p class="text-[var(--color-text)] text-sm font-medium">Software Engineer Intern</p>
            <p class="text-[var(--color-muted)] text-xs leading-relaxed mt-1">
              Interned at Examedi (YC S21 medtech startup), developing internal tooling using BS4 and regex to streamline onboarding for clinics and independent practitioners. Performed geospatial analysis on transaction data to identify underserved regions in Santiago with high patient demand and excessive practitioner travel times.
            </p>
          </div>
        </li>
        <li>
          <div class="flex items-baseline justify-between gap-4">
            <span class="font-serif text-lg font-medium">SmartUp</span>
            <span class="text-xs text-[var(--color-muted)] flex-shrink-0">Winter 2024</span>
          </div>
          <div class="mt-2 pl-3 border-l border-[var(--color-border)]">
            <p class="text-[var(--color-text)] text-sm font-medium">Software Engineer Intern</p>
            <p class="text-[var(--color-muted)] text-xs leading-relaxed mt-1">
              Briefly worked to help augment LLM tooling in internal chats, utilizing the openAI SDK to integrate <b>plotly.js</b> into their Next.js frontend and helping migrate to streaming packets from the completions API.
            </p>
          </div>
        </li>
        <li>
          <div class="flex items-baseline justify-between gap-4">
            <span class="font-serif text-lg font-medium">University of Miami</span>
            <span class="text-xs text-[var(--color-muted)] flex-shrink-0">Apr 2025 — Present</span>
          </div>
          <div class="mt-2 pl-3 border-l border-[var(--color-border)]">
            <p class="text-[var(--color-text)] text-sm font-medium">Research Assistant, Frost Institute for Data Science and Computing</p>
            <p class="text-[var(--color-muted)] text-xs leading-relaxed mt-1">
              Developing a multi-model fusion framework for kidney cancer segmentation using self-attention. Built ETL pipeline for DICOM MRI scans and scaled training across 4 L40 GPUs with PyTorch DDP. Third author on forthcoming publication.
            </p>
          </div>
          <div class="mt-3 pl-3 border-l border-[var(--color-border)]">
            <p class="text-[var(--color-text)] text-sm font-medium">Teaching Assistant, Department of Computer Science</p>
            <p class="text-[var(--color-muted)] text-xs leading-relaxed mt-1">
              Guiding 500+ students through labs and office hours for Computer Programming II, teaching data structures, algorithms, and OOP in Java and Python. Automated grading workflows by refactoring legacy Python 2.7 scripts.
            </p>
          </div>
        </li>
      </ul>
    </section>

    <!-- Personal Projects -->
    <section class="mb-20">
      <h2 class="text-sm font-medium uppercase tracking-wider text-[var(--color-muted)] mb-6">
        Personal Projects
      </h2>
      <GradientLine seed={29} class="mb-8" />
      <ul class="space-y-6">
        <li class="group">
          <a href="#" class="block">
            <div class="flex items-baseline justify-between gap-4">
              <span class="font-serif text-lg font-medium group-hover:text-[var(--color-accent)] transition-colors duration-150">
                tinyHPO
              </span>
              <span class="text-xs text-[var(--color-muted)] font-mono flex-shrink-0">
                Python / tinygrad / wandb
              </span>
            </div>
            <p class="text-sm text-[var(--color-muted)] mt-1 leading-relaxed">
              Hyperparameter optimization tools for the tinygrad framework (30k stars). Model-agnostic GridSearchCV and Bayesian optimization APIs with lazy evaluation via tinyJIT.
            </p>
          </a>
        </li>
        <li class="group">
          <a href="#" class="block">
            <div class="flex items-baseline justify-between gap-4">
              <span class="font-serif text-lg font-medium group-hover:text-[var(--color-accent)] transition-colors duration-150">
                Graph-Based HRM
              </span>
              <span class="text-xs text-[var(--color-muted)] font-mono flex-shrink-0">
                PyTorch / OR-Tools
              </span>
            </div>
            <p class="text-sm text-[var(--color-muted)] mt-1 leading-relaxed">
              Adapting the HRM architecture for NP-hard graph-based CSPs. Sparse edge embeddings with combined supervised and reinforcement learning for improved convergence.
            </p>
          </a>
        </li>
      </ul>
    </section>

    <!-- Education -->
    <section class="mb-20">
      <h2 class="text-sm font-medium uppercase tracking-wider text-[var(--color-muted)] mb-6">
        Education
      </h2>
      <GradientLine seed={37} class="mb-8" />
      <ul class="space-y-8">
        <li>
          <div class="flex items-baseline justify-between gap-4 mb-3">
            <span class="font-serif text-lg font-medium">University of Miami</span>
            <span class="text-xs text-[var(--color-muted)] flex-shrink-0">Expected May 2027</span>
          </div>
          <p class="text-[var(--color-text)] text-sm font-medium">B.S. Computer Science, B.S. Mathematics</p>
          <p class="text-[var(--color-muted)] text-xs mt-1">Minor in Physics</p>
          <p class="text-[var(--color-muted)] text-xs leading-relaxed mt-2">
            GPA: 3.86 · Singer Scholar (Full Tuition) · Foote Fellow Honors Program · <a href="/transcript.pdf" class="no-underline hover:underline underline-offset-2 hover:text-[var(--color-muted)]">Transcript</a>
          </p>
          <p class="text-[var(--color-muted)] text-xs leading-relaxed mt-2">
          Relevant coursework: Data Structures & Algorithms, Machine Learning, Stochastic Modeling, Statistical Analysis, Probability Theory, Game Theory.
          </p>
        </li>
      </ul>
    </section>

    <!-- Writing -->
    {recentPosts.length > 0 && (
      <section>
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-sm font-medium uppercase tracking-wider text-[var(--color-muted)]">
            Writing
          </h2>
          <a
            href="/blog"
            class="text-sm text-[var(--color-muted)] hover:text-[var(--color-text)] transition-colors duration-150"
          >
            View all &rarr;
          </a>
        </div>
        <GradientLine seed={42} class="mb-8" />
        <ul class="space-y-5">
          {recentPosts.map((post) => (
            <li class="flex items-baseline justify-between gap-4">
              <a
                href={`/blog/${post.id}`}
                class="font-serif text-base hover:text-[var(--color-accent)] transition-colors duration-150 truncate"
              >
                {post.data.title}
              </a>
              <time
                datetime={post.data.date.toISOString()}
                class="text-sm text-[var(--color-muted)] flex-shrink-0"
              >
                {formatDate(post.data.date)}
              </time>
            </li>
          ))}
        </ul>
      </section>
    )}
  </div>
</BaseLayout>
