---
interface Props {
  title: string;
  seed?: number;
}

const { title, seed } = Astro.props;

function hashString(str: string): number {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    const char = str.charCodeAt(i);
    hash = ((hash << 5) - hash) + char;
    hash = hash & hash;
  }
  return Math.abs(hash);
}

const finalSeed = seed ?? hashString(title);
const hue1 = (finalSeed * 137.508) % 360;
const hue2 = (hue1 + 30) % 360;
const hue3 = (hue1 + 180) % 360;
const turbulenceFreq = 0.004 + (finalSeed % 10) * 0.0003;
---

<div class="post-header">
  <svg class="post-header-svg" viewBox="0 0 1600 180" preserveAspectRatio="xMidYMid slice">
    <defs>
      <filter id={`post-noise-${finalSeed}`} x="-20%" y="-20%" width="140%" height="140%">
        <feTurbulence
          type="fractalNoise"
          baseFrequency={turbulenceFreq}
          numOctaves="3"
          seed={finalSeed}
          stitchTiles="stitch"
          result="noise"
        />
        <feColorMatrix type="saturate" values="0.3" result="desaturatedNoise" />
        <feBlend in="SourceGraphic" in2="desaturatedNoise" mode="overlay" />
      </filter>

      <linearGradient id={`post-grad1-${finalSeed}`} x1="0%" y1="50%" x2="100%" y2="50%">
        <stop offset="0%" style={`stop-color: hsl(${hue1}, 82%, 58%); stop-opacity: 0.85`} />
        <stop offset="50%" style={`stop-color: hsl(${hue2}, 78%, 52%); stop-opacity: 0.9`} />
        <stop offset="100%" style={`stop-color: hsl(${hue3}, 72%, 48%); stop-opacity: 0.85`} />
      </linearGradient>

      <radialGradient id={`post-grad2-${finalSeed}`} cx="10%" cy="90%" r="60%">
        <stop offset="0%" style={`stop-color: hsl(${hue2}, 88%, 62%); stop-opacity: 0.8`} />
        <stop offset="100%" style={`stop-color: hsl(${hue1}, 65%, 42%); stop-opacity: 0`} />
      </radialGradient>

      <radialGradient id={`post-grad3-${finalSeed}`} cx="90%" cy="20%" r="50%">
        <stop offset="0%" style={`stop-color: hsl(${hue3}, 84%, 64%); stop-opacity: 0.75`} />
        <stop offset="100%" style={`stop-color: hsl(${hue2}, 55%, 38%); stop-opacity: 0`} />
      </radialGradient>

      <radialGradient id={`post-grad4-${finalSeed}`} cx="55%" cy="60%" r="40%">
        <stop offset="0%" style={`stop-color: hsl(${hue1 + 50}, 75%, 60%); stop-opacity: 0.65`} />
        <stop offset="100%" style={`stop-color: hsl(${hue2}, 45%, 35%); stop-opacity: 0`} />
      </radialGradient>

      <filter id={`post-blur-${finalSeed}`}>
        <feGaussianBlur in="SourceGraphic" stdDeviation="20" />
      </filter>
    </defs>

    <rect width="100%" height="100%" fill="#fafafa" />

    <g filter={`url(#post-blur-${finalSeed})`}>
      <g class="blob blob-1">
        <ellipse cx="12%" cy="75%" rx="20%" ry="50%" fill={`url(#post-grad2-${finalSeed})`} />
      </g>
      <g class="blob blob-2">
        <ellipse cx="88%" cy="25%" rx="22%" ry="45%" fill={`url(#post-grad3-${finalSeed})`} />
      </g>
      <g class="blob blob-3">
        <ellipse cx="50%" cy="60%" rx="25%" ry="35%" fill={`url(#post-grad4-${finalSeed})`} />
      </g>
      <rect width="100%" height="100%" fill={`url(#post-grad1-${finalSeed})`} opacity="0.4" />
    </g>

    <rect width="100%" height="100%" filter={`url(#post-noise-${finalSeed})`} opacity="0.12" />

    <path
      d="M 0,120 Q 400,100 800,115 T 1600,95"
      fill="none"
      stroke={`hsl(${hue1}, 45%, 48%)`}
      stroke-width="0.5"
      opacity="0.15"
      class="wave"
    />
  </svg>
</div>

<style>
  .post-header {
    position: relative;
    width: calc(100vw - 2rem);
    margin-left: calc(-50vw + 50% + 1rem);
    height: 100px;
    overflow: hidden;
    margin-bottom: 2rem;
    border-radius: 0.5rem;
  }

  @media (min-width: 768px) {
    .post-header {
      width: calc(100vw - 4rem);
      margin-left: calc(-50vw + 50% + 2rem);
    }
  }

  .post-header-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .blob-1 {
    animation: float-1 10s ease-in-out infinite;
  }

  .blob-2 {
    animation: float-2 12s ease-in-out infinite;
  }

  .blob-3 {
    animation: float-3 8s ease-in-out infinite;
  }

  .wave {
    animation: wave-flow 7s ease-in-out infinite;
  }

  @keyframes float-1 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(10px, -8px) scale(1.04); }
  }

  @keyframes float-2 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(-8px, 6px) scale(0.96); }
  }

  @keyframes float-3 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(6px, -5px) scale(1.03); }
    66% { transform: translate(-4px, 4px) scale(0.98); }
  }

  @keyframes wave-flow {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(15px); }
  }

  @media (prefers-reduced-motion: reduce) {
    .blob, .wave {
      animation: none;
    }
  }
</style>
